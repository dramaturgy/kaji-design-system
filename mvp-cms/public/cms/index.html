<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="initial-scale=1, shrink-to-fit=no, width=device-width" name="viewport">
    <!-- CSS -->
    <link rel="stylesheet" href="../css/kaji-material.css">
    <link rel="stylesheet" href="../css/product-cms.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://use.fontawesome.com/ebb6ee31d7.js"></script>
    <!-- Add Material CSS, replace Bootstrap CSS -->
  </head>
  <body>
    <nav class="navbar navbar-expand-lg fixed-top navbar-light bg-white faux-border-bottom p-0">
      <div class="container-fluid px-0">
        <div class="row no-gutters">
          <div class="col-3 col-md-2">
            <a class="navbar-brand w-100 border-right" href="#"><span class="d-block w-100 text-center text-primary">$</span></a>
          </div>

          <div class="col-3 col-md-3 px-3">
            <div class="h-100 d-flex flex-row">
              <span class="align-center h-100 text-primary mr-2" data-feather="home"></span>
                <a class="h5 m-0 p-0 text-bold text-dark h-100 lh-5" href="javascript:void(0);"
                  title="The Very Long School Name at some place"
                  data-toggle="modal"
                  data-target="#js_cms_school_list_modal"
                  style="
                    max-width: 100%;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    white-space: nowrap;">
                  <h6 class="d-inline-block m-0 font-weight-normal">The Very Very Long School Name at some place</h6>
                </a>
                <span class="fa fa-caret-down ml-auto px-2 align-self-center text-primary"></span>
            </div>
            <div class="navbar-ornament-a"
              style="
                position: absolute;
                display: block;
                bottom: -0.75rem;
                left: 1rem;
                right: 1rem;
                background-color: rgba(147, 78, 197, 1);
                height: 1px;"></div>
          </div>
          
          <ul class="navbar-nav ml-md-auto border-left px-3">
            <li class="nav-item">
              <a class="nav-link py-1 px-2 dropdown-toggle"
                data-toggle="dropdown"
                id="js_cms_navbar_user_dropdown"
                href="javascript:void(0);"><span
                  class="d-inline-block align-bottom lh-4">My Name</span><span
                    class="d-inline-block align-bottom ml-1" data-feather="chevron-down"></span></a>
              <div class="dropdown-menu">
                <a class="dropdown-item" href="#">Action 1</a>
                <a class="dropdown-item" href="#">Action 2</a>
                <a class="dropdown-item" href="#">Settings</a>
                <a class="dropdown-item" href="#">Logout</a>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link p-0 mx-2"
                style="border-radius: 50%; overflow: hidden; opacity: 1;" 
                href="javascript:void(0);"><img height="32" src="../copy/sample/avatar/admin.png" alt=""></a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container-fluid px-0">
      <div class="row no-gutters">
        
        <nav class="cms-sidenav col-3 col-md-2 d-none d-md-block bg-white">
          <div class="cms-sidenav-sticky has-navbar-fixed">
            <ul class="nav flex-column">
              <li class="nav-item ">
                <a class="nav-link py-3  active" href="/cms">
                  <span class="d-inline-block align-bottom" data-feather="layout"></span>
                  <span class="d-inline-block lh-lg align-bottom ml-3">Dashboard</span></a>
              </li>
              <li class="nav-item ">
                <a class="nav-link py-3 " href="/cms/tuition.html">
                  <span class="d-inline-block align-bottom" data-feather="align-justify"></span>
                  <span class="d-inline-block lh-lg align-bottom ml-3">Tuition Fee</span></a>
              </li>
              <li class="nav-item ">
                <a class="nav-link py-3 " href="javascript:void(0);">
                  <span class="d-inline-block align-bottom" data-feather="monitor"></span>
                  <span class="d-inline-block lh-lg align-bottom ml-3">Entry Fee</span></a>
              </li>
              <li class="nav-item ">
                <a class="nav-link py-3 " href="javascript:void(0);">
                  <span class="d-inline-block align-bottom" data-feather="users"></span>
                  <span class="d-inline-block lh-lg align-bottom ml-3">Student</span></a>
              </li>
              <li class="nav-item ">
                <a class="nav-link py-3 " href="javascript:void(0);">
                  <span class="d-inline-block align-bottom" data-feather="award"></span>
                  <span class="d-inline-block lh-lg align-bottom ml-3">Scores</span></a>
              </li>
              <li class="nav-item ">
                <a class="nav-link py-3 " href="javascript:void(0);">
                  <span class="d-inline-block align-bottom" data-feather="book-open"></span>
                  <span class="d-inline-block lh-lg align-bottom ml-3">Programmes</span></a>
              </li>
              <li class="nav-item faux-border-top">
                <a class="nav-link py-3 " href="javascript:void(0);">
                  <span class="d-inline-block align-bottom" data-feather="send"></span>
                  <span class="d-inline-block lh-lg align-bottom ml-3">Posting</span></a>
              </li>
            </ul>
          </div>
        </nav>
        <main role="main" class="dashboard-main col-12 col-md-10 bg-light-2 py-3" id="js_dashboard_main" style="min-height: 100vh">
          <div class="container-fluid has-navbar-fixed">
            <section class="row align-items-stretch">
              <div class="col">
                <div class="card border-black-divider-solid mb-3">
                  <div class="card-body px-2 py-3">
                    <div class="d-flex align-items-center">
                      <h4 class="align-self-center m-0 px-4 text-dark">Dashboard</h4>
                      <p class="align-self-center m-0 px-4 border-left text-muted lh-3" style="font-size: 0.75rem;">Lorem ipsum dolor sit amet, consectetur adipisicing elit. <br>Doloremque dignissimos dolor accusamus.</p>
                    </div>
                  </div>
                </div>
              </div>
            </section>
            <section class="row flex-nowrap">
              <div class="col">
                <div class="card border-black-divider-solid mb-3">
                  <div class="card-body p-3">

                    <p class="subsubheading-black text-dark mb-2">MESSAGES</p>

                    <div class="d-flex flex-nowrap card-message-wrapper">


                      <a href="javacript:void(0);" class="card card-message no-elevation text-dark js-card-message" data-message-id="1">
                        <div class="card-body border-black-divider-solid bg-white py-3">
                          <div class="message-head">
                            <div class="message-label">
                              <span class="badge badge-primary text-white">new</span>
                            </div>
                            <p class="message-title js-message-title">Very long title shall get truncated with ellipsis</p>
                          </div>
                          <p class="message-caption">Lorem ipsum dolor sit amet cons, ectetur adipisicing elit.</p>
                          <div class="message-meta">
                            <p class="message-sender text-primary"><span class="fa fa-user-o mr-2 text-muted"></span>Jean Baudrillard</p>
                            <p class="message-timeago text-muted"><span class="fa fa-calendar-o mr-2"></span>Now</p>
                          </div>
                        </div>
                      </a>
                      <a href="javacript:void(0);" class="card card-message no-elevation text-dark js-card-message" data-message-id="2">
                        <div class="card-body border-black-divider-solid bg-white py-3">
                          <div class="message-head">
                            <div class="message-label">
                              <span class="badge badge-secondary text-white">some long label</span>
                            </div>
                            <p class="message-title js-message-title">This one is shorter</p>
                          </div>
                          <p class="message-caption">Lorem ipsum dolor sit amet cons, ectetur adipisicing elit.</p>
                          <div class="message-meta">
                            <p class="message-sender text-primary"><span class="fa fa-user-o mr-2 text-muted"></span>Jean Baudrillard</p>
                            <p class="message-timeago text-muted"><span class="fa fa-calendar-o mr-2"></span>2 days ago</p>
                          </div>
                        </div>
                      </a>
                      <a href="javacript:void(0);" class="card card-message no-elevation text-dark js-card-message" data-message-id="3">
                        <div class="card-body border-black-divider-solid bg-white py-3">
                          <div class="message-head">
                            <div class="message-label">
                              <span class="badge badge-info text-white">old</span>
                            </div>
                            <p class="message-title js-message-title">How about this</p>
                          </div>
                          <p class="message-caption">Lorem ipsum dolor sit amet cons, ectetur adipisicing elit.</p>
                          <div class="message-meta">
                            <p class="message-sender text-primary"><span class="fa fa-user-o mr-2 text-muted"></span>Jean Baudrillard</p>
                            <p class="message-timeago text-muted"><span class="fa fa-calendar-o mr-2"></span>Yesterday</p>
                          </div>
                        </div>
                      </a>
                      <a href="javacript:void(0);" class="card card-message no-elevation text-dark js-card-message" data-message-id="4">
                        <div class="card-body border-black-divider-solid bg-white py-3">
                          <div class="message-head">
                            <div class="message-label">
                              <span class="badge badge-warning text-white">inbox</span>
                            </div>
                            <p class="message-title js-message-title">This should overflowing the boundary</p>
                          </div>
                          <p class="message-caption">Lorem ipsum dolor sit amet cons, ectetur adipisicing elit.</p>
                          <div class="message-meta">
                            <p class="message-sender text-primary"><span class="fa fa-user-o mr-2 text-muted"></span>Jean Baudrillard</p>
                            <p class="message-timeago text-muted"><span class="fa fa-calendar-o mr-2"></span>Dec 7, 2017</p>
                          </div>
                        </div>
                      </a>
                      <a href="javacript:void(0);" class="card card-message no-elevation text-dark js-card-message" data-message-id="5">
                        <div class="card-body border-black-divider-solid bg-white py-3">
                          <div class="message-head">
                            <div class="message-label">
                              <span class="badge badge-danger text-white">some taxonomy</span>
                            </div>
                            <p class="message-title js-message-title">Asking you!</p>
                          </div>
                          <p class="message-caption">Lorem ipsum dolor sit amet cons, ectetur adipisicing elit.</p>
                          <div class="message-meta">
                            <p class="message-sender text-primary"><span class="fa fa-user-o mr-2 text-muted"></span>Jean Baudrillard</p>
                            <p class="message-timeago text-muted"><span class="fa fa-calendar-o mr-2"></span>Dec 9, 2018</p>
                          </div>
                        </div>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            
            <script id="js_dashboard_message_article_template" type="text/x-lodash-template">
              <article
                class="card border-black-divider-solid message-article js-message-article"
                id="js_message_article_<@= id @>"
              >
                <div class="card-body marticle-card">
                  <div class="marticle-head">
                    <div class="marticle-action-wrapper ml-auto">
                      <a class="marticle-action" href="javacript:void(0);"><span data-feather="star"></span></a>
                      <a class="marticle-action" href="javacript:void(0);"><span data-feather="trash"></span></a>
                      <a class="marticle-action" href="javacript:void(0);"><span data-feather="x"></span></a>
                    </div>
                  </div>
                  <div class="marticle-body">
                    <div class="marticle-body-scroll">
                      <p class="marticle-title mb-2"><@= title @></p>
                      <p class="marticle-sender m-0 text-muted text-sm" style="font-size: .75rem; line-height: 1rem;"><span class="fa fa-user-o" style="display: inline-block; width: 1rem;"></span> <span>Jean Baudrillard</span></p>
                      <p class="marticle-sender text-muted text-sm" style="font-size: .75rem; line-height: 1rem;"><span class="fa fa-calendar" style="display: inline-block; width: 1rem;"></span> <span>Yesterday</span></p>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius, culpa. Deleniti sed vitae expedita fugiat, tenetur facere dolorum sit, officiis laboriosam dolore dolores dicta aliquam voluptatum facilis. Earum, nostrum, porro!</p>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius, culpa. Deleniti sed vitae expedita fugiat, tenetur facere dolorum sit, officiis laboriosam dolore dolores dicta aliquam voluptatum facilis. Earum, nostrum, porro!</p>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius, culpa. Deleniti sed vitae expedita fugiat, tenetur facere dolorum sit, officiis laboriosam dolore dolores dicta aliquam voluptatum facilis. Earum, nostrum, porro!</p>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius, culpa. Deleniti sed vitae expedita fugiat, tenetur facere dolorum sit, officiis laboriosam dolore dolores dicta aliquam voluptatum facilis. Earum, nostrum, porro!</p>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius, culpa. Deleniti sed vitae expedita fugiat, tenetur facere dolorum sit, officiis laboriosam dolore dolores dicta aliquam voluptatum facilis. Earum, nostrum, porro!</p>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius, culpa. Deleniti sed vitae expedita fugiat, tenetur facere dolorum sit, officiis laboriosam dolore dolores dicta aliquam voluptatum facilis. Earum, nostrum, porro!</p>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius, culpa. Deleniti sed vitae expedita fugiat, tenetur facere dolorum sit, officiis laboriosam dolore dolores dicta aliquam voluptatum facilis. Earum, nostrum, porro!</p>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius, culpa. Deleniti sed vitae expedita fugiat, tenetur facere dolorum sit, officiis laboriosam dolore dolores dicta aliquam voluptatum facilis. Earum, nostrum, porro!</p>
                      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius, culpa. Deleniti sed vitae expedita fugiat, tenetur facere dolorum sit, officiis laboriosam dolore dolores dicta aliquam voluptatum facilis. Earum, nostrum, porro!</p>
                    </div>
                  </div>
                  <div class="marticle-foot">
                    <div class="marticle-action-wrapper w-100" style="justify-content: center;">
                      <a class="marticle-action text-white bg-dark rounded" href="javacript:void(0);"><span data-feather="chevron-right"></span><span class="px-2" style="line-height: 1rem;">Reply</span></a>
                      <a class="marticle-action text-white bg-dark rounded" href="javacript:void(0);"><span data-feather="chevrons-right"></span><span class="px-2" style="line-height: 1rem;">Reply All</span></a>
                    </div>
                  </div>
                </div>
              </article>
            </script>          </div>
        </main>
      </div>
    </div>

    <script src="../copy/vendor/jquery.min.js"></script>
    <script src="../copy/vendor/popper.min.js"></script>
    <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
    <script src="../copy/vendor/bootstrap.min.js"></script>
    <script src="../copy/vendor/material.min.js"></script>
    <script src="../copy/vendor/lodash.min.js"></script>
    <script src="../copy/vendor/jquery.dynatable.js"></script>
    <script src="../copy/vendor/bootstrap-select.min.js"></script>
    <script src="../copy/vendor/datepicker.min.js"></script>
    <script src="../copy/vendor/datepicker.en.js"></script>
    <script src="../copy/vendor/interact.min.js"></script>

    
    <script>feather.replace();</script>

    
    <script>
      $(function () {

        // Lodash template custom delimiter
        _.templateSettings = {
            interpolate: /\<\@\=(.+?)\@\>/g,
            evaluate: /\<\@(.+?)\@\>/g
        };

        // Cache elements
        var $msgCards = $('.js-card-message');

        function initResizeInteraction( el, ctx ) {
          if ( !el.length && ctx.length ) return;

          function resizemovehandler( e ) {
            var target = e.target,
                x = (parseFloat(target.getAttribute('data-x')) || 0),
                y = (parseFloat(target.getAttribute('data-y')) || 0);

            target.style.width  = e.rect.width + 'px';
            target.style.height = e.rect.height + 'px';

            target.style.webkitTransform =
            target.style.transform = 'translate(' + x + 'px,' + y + 'px)';

            target.setAttribute('data-x', x);
            target.setAttribute('data-y', y);
          }

          // initiate interactjs
          interact(el)
            .resizable({
              edges: { left: false, right: false, bottom: false, top: true },
              restrictEdges: {
                endOnly: false
              },
              restrictSize: {
                min: { height: 64 },
                max: { height: 480 }
              },
              inertia: true
            })
            .on('resizemove', resizemovehandler);
        }

        function initMessageCards( el ) {
          if ( !el.length ) return;

          function generateMessageArticle( templateIn, data ) {
            var templateFn = _.template(templateIn.html());
            var templateOut = templateFn(data);
            return templateOut;
          }

          var $root = $('#js_dashboard_main')
          ,   $msgArticleWrapper = $('<div>')
              .attr({
                'id': 'js_dashboard_message_article_wrapper',
                'class': 'message-article-wrapper',
                'data-message-opened': '0'
              });

          $root.append( $msgArticleWrapper );
          $msgArticleWrapper = $root.find('#js_dashboard_message_article_wrapper');

          // Loop the message cards
          el.each( function(i) {
            var $self = $(this);
            
            // Initiate click event
            $self.on('click', function(e) {
              e.preventDefault();

              // Check if message not already open
              if ( !$self[0].hasAttribute( 'data-message-open' ) ) {

                // Populate data
                var _data = {
                  id: $self.attr('data-message-id') || '0',
                  title: $self.find('.js-message-title').text()
                };

                // Append message article into DOM, along it's data
                $msgArticleWrapper
                  .append( generateMessageArticle( $('#js_dashboard_message_article_template'), _data ) );

                // Add the message opened counter
                var msgOpenCounter = parseInt( $msgArticleWrapper.attr('data-message-opened') );
                msgOpenCounter++;
                $msgArticleWrapper.attr('data-message-opened', msgOpenCounter);
                
                // Cache the newly appended message article
                var $msgArticle = $msgArticleWrapper.find( '#js_message_article_' + _data.id );

                // Cache message order
                var msgOrder = $msgArticleWrapper.attr('data-message-opened');

                // Set attr with message order
                $msgArticle.attr('data-message-order', msgOrder );

                // Set message article initial layout & z-index
                $msgArticle.css({
                  'right': 96 * ( parseInt( msgOrder ) - 1 ),
                  'z-index': msgOrder
                });

                // Init resize
                initResizeInteraction( $msgArticle[0], $msgArticleWrapper[0] );

                // Feather icons. This looks unnecessarily ugly -___-
                $msgArticle.find('[data-feather]').each(function() {
                  var $self = $(this);
                  if ( $self.attr('data-feather').length )
                    $self.parent().prepend(
                      feather.icons[$self.attr('data-feather')]
                      .toSvg({
                        width: '16',
                        height: '16'
                      })
                    );
                });

                // Toggle message open flag
                $self.attr('data-message-open', '');
              }
            });
          });

          // Swapping Z
          $(document).on('click', '.js-message-article', function(e) {
            e.preventDefault();
            if ( !$('.js-message-article').length || $('.js-message-article').length < 1 ) return false;
            var $self = $(this);

            var zIndexes = _.map( $('.js-message-article'), function(el) { return parseInt( $(el).css('z-index') ) })
            ,   maxZ = _.max( zIndexes )
            ,   currentZ = parseInt( $self.css('z-index') );
            console.log( zIndexes, maxZ, currentZ );

            if ( currentZ < maxZ ) $self.css('z-index', maxZ + 1);
          })
        }

        initMessageCards( $msgCards );
      });
    </script>
  </body>
</html>